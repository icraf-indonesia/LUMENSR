---
title: "Pre-QUES"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Pre-QUES}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(LUMENSR)
library(magrittr)
library(dplyr)
library(purrr)
library(networkD3)
library(terra)
library(sf)
library(ggplot2)
library(ggrepel)
library(stringr)
library(viridis)
library(scales)
```

# 1. Data yang digunakan

```{r}
lc_lookup_klhk %>%  abbreviate_lookup()
```

```{r}
NTT_LC90 <- LUMENSR_example("NTT_LC90.tif") %>%
									 terra::rast() %>%
									 add_legend_to_categorical_raster(
									 raster_file = .,
									 lookup_table = lc_lookup_klhk_sequence)

plot_categorical_raster(NTT_LC90)
```

```{r}

NTT_LC20 <- LUMENSR_example("NTT_LC20.tif") %>%
									 terra::rast() %>%
									 add_legend_to_categorical_raster(
									 raster_file = .,
									 lookup_table = lc_lookup_klhk_sequence)

plot_categorical_raster(NTT_LC20)
```

```{r}
 plot_planning_unit(ntt_admin, "Kabupaten")
```

## Tabel deskripsi singkatan

```{r}
tabel_singkatan <- lc_lookup_klhk_sequence %>% 
  dplyr::select(-color_pallette)

print(tabel_singkatan)
```

# 2. Hasil analisis pada tingkat bentang lahan

## Tabel kondisi tutupan lahan
```{r}
lc_freq_table<- calc_lc_freq(raster_list = list(NTT_LC90, NTT_LC20))
lc_freq_table
```

## Komposisi tutupan lahan
```{r}
lc_freq_table %>% abbreviate_by_column( "Jenis tutupan lahan", remove_vowels = FALSE) %>% 
  plot_lc_freq(column_lc_type = "Jenis tutupan lahan", 
               column_T1 = "NTT_LC90_count", 
               column_T2 = "NTT_LC20_count")
```



## Alur perubahan lahan dominan

```{r}
raster_files <- c("NTT_LC90.tif", "NTT_LC20.tif") %>%
    map(LUMENSR_example) %>%
    map(rast)

# Loop through raster files
raster_list <- 
  map(raster_files, ~ apply_lookup_table(raster_file = .x, lookup_lc = lc_lookup_klhk_sequence))

# Turn raster files into a frequency table
crosstab_result <- create_crosstab(raster_list)
```

### Kondisi tutupan lahan keseluruhan

```{r}
# Input
crosstab_result_abbreviated <- crosstab_result %>% abbreviate_by_column( c("NTT_LC90", "NTT_LC20"), remove_vowels = FALSE)
create_sankey(freq_table = crosstab_result_abbreviated, area_cutoff = 10000, change_only = FALSE)
```

### Potret perubahan tutupan lahan

Tanpa mempertimbangkan tutupan lahan yang tidak berubah/ tetap.

```{r}
create_sankey(freq_table = crosstab_result_abbreviated, area_cutoff = 10000, change_only = TRUE)
```

## 10 jenis perubahan dominan

### Dalam Tabel

```{r}
luc_top_10 <- crosstab_result %>% calc_top_lcc(n_rows = 10) %>%
  abbreviate_by_column( c("NTT_LC90", "NTT_LC20"), remove_vowels = FALSE)


luc_top_10
```

### Dalam grafik

```{r}
luc_top_10 %>% plot_lcc_freq_bar(col_T1 = "NTT_LC90" , col_T2 = "NTT_LC20",Freq = "Freq")

```

# Hasil analisis pada unit perencanaan
