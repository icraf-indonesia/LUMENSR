---
title: "PreQuES-Land Use Change Trajectory Analysis"
format: 
   html:
     df-print: kable
toc: true
number-sections: true
editor: visual
editor_options: 
  chunk_output_type: inline
execute:
  cache: false
engine: knitr
---

```{r}
#| echo: false
#| eval: false
# key raster inputs: lc_t1_, lc_t2_, admin_
# key table inputs: lookup_traj_reclass, lookup_trajectory_complete
# key column inputs : trajectory and def

# key raster output: map_trajectory, map_deforest_degrad
```

```{r Load land cover data}
#| echo: false
#| warning: false

library(LUMENSR)
library(magrittr)
library(terra)

# Prepare a lookup table by abbreviating column 'PL20' in the predefined table 'lc_lookup_klhk_sequence'
lookup_tbl <- lc_lookup_klhk_sequence %>% abbreviate_by_column(col_names = "PL20")

# Load the land cover data for period 1990 from the provided example data set in LUMENSR package
# Convert the loaded data to a raster using terra::rast()
# Add a legend to the categorical raster using the lookup table created earlier
lc_t1_ <- LUMENSR_example("NTT_LC90.tif") %>%
  terra::rast() %>%
  add_legend_to_categorical_raster(
    raster_file = .,
    lookup_table = lookup_tbl
  ) %>% 
  assign_time_period(year_ = "1990")

# Similarly, load the land cover data for period 2020 and add the legend
lc_t2_ <- LUMENSR_example("NTT_LC20.tif") %>%
  terra::rast() %>%
  add_legend_to_categorical_raster(
    raster_file = .,
    lookup_table = lookup_tbl
  ) %>% 
  assign_time_period(year_ = "2020")

# Load the planning unit data. Note that 'ntt_admin' must be defined somewhere earlier in the code.
admin_z <- ntt_admin %>% rasterise_multipolygon()
```

```{r trajectory map}
#| echo: false
#| warning: false
traj_analysis_output <-
  ques_pre_trajectory(
    lc_t1_ = lc_t1_,
    lc_t2_ = lc_t2_,
    admin_ = admin_z,
    lookup_traj_reclass = lookup_traj_reclass,
    lookup_trajectory_complete = lookup_trajectory_complete,
    trajectory_column_name = "trajectory",
    convert_to_Ha = TRUE
  )
```

```{r deforest/degrad map}
#| echo: false
#| warning: false
def_analysis_output <-
  ques_pre_trajectory(
    lc_t1_ = lc_t1_,
    lc_t2_ = lc_t2_,
    admin_ = admin_z,
    lookup_traj_reclass = lookup_traj_reclass,
    lookup_trajectory_complete = lookup_trajectory_complete,
    trajectory_column_name = "def",
    convert_to_Ha = TRUE
  )
```

# Analisis alur penggunaan lahan (FAO)

## Hasil analisis alur penggunaan lahan pada tingkat bentang lahan

### Peta kelompok perubahan penutupan lahan

```{r}
#| echo: false
traj_analysis_output$landscape_level$luc_trajectory_map |> plot_categorical_raster()
```

### Intisari kelompok perubahan penutupan lahan

::: panel-tabset
### Tabel

```{r}
#| echo: false
traj_analysis_output$landscape_level$table_traj_area
```

### Grafik

```{r}
#| echo: false
traj_analysis_output$landscape_level$barplot_traj
```
:::

# Analisis alur penggunaan lahan (Deforestasi dan Degradasi)

## Hasil analisis alur penggunaan lahan pada tingkat bentang lahan

### Peta kelompok perubahan penutupan lahan

```{r}
#| echo: false
def_analysis_output$landscape_level$luc_trajectory_map |> plot_categorical_raster()
```

### Intisari kelompok perubahan penutupan lahan

::: panel-tabset
### Tabel

```{r}
#| echo: false
def_analysis_output$landscape_level$table_traj_area
```

### Grafik

```{r}
#| echo: false
def_analysis_output$landscape_level$barplot_traj
```
:::
