---
title: "PreQuES-Land Use Change Trajectory Analysis"
format: 
   html:
     df-print: kable
toc: true
number-sections: true
editor: visual
editor_options: 
  chunk_output_type: console
execute:
  cache: false
engine: knitr
params:
  dir_traj_map_: "NA"
  dir_def_map_: "NA"
  dir_ques_pre_traj: "NA"
  dir_ques_pre_traj_def: "NA"
---

```{r}
#| echo: false
#| eval: false
# dir_traj_map_ : a directory to a spatraster object of land use trajectory classes
# dir_def_map_  : a directory to a spatraster object of deforestation and forest degradation trajectory classes
# dir_ques_pretraj: a directory to an .Rdata that contains a result from the ques_pre_trajectory function

library(magrittr)
library(terra)
library(LUMENSR)

traj_map <- rast(params$dir_traj_map_)
def_map <- rast(params$dir_def_map_)
traj_analysis_output <- readRDS(params$dir_ques_pre)
def_analysis_output <- readRDS(params$dir_ques_pre_traj_def)
```


# Analisis alur penggunaan lahan (FAO)

## Hasil analisis alur penggunaan lahan pada tingkat bentang lahan

### Peta kelompok perubahan penutupan lahan

```{r}
#| echo: false
#| warning: false
traj_map |> plot_categorical_raster()
```

### Intisari kelompok perubahan penutupan lahan

::: panel-tabset
#### Tabel

```{r}
#| echo: false
traj_analysis_output$landscape_level$table_traj_area
```

#### Grafik

```{r}
#| echo: false
traj_analysis_output$landscape_level$barplot_traj
```
:::

## Hasil analisis pada tingkat unit perencanaan

```{r}
#| echo: false
render_child <- function(results_list, i) {
  res = knitr::knit_child(
   text = xfun::read_utf8("quespretraj_by_pu.qmd"),
   envir = rlang::env(results_list = results_list, i = i),
   quiet = TRUE
  )
  cat(res, sep = '\n')
  cat("\n")
}
```

```{r}
#| results: "asis"
#| echo: false
for (i in names(traj_analysis_output[["pu_level"]])) {
  render_child(results_list = traj_analysis_output[["pu_level"]], i = i)
}
```

# Analisis alur penggunaan lahan (Deforestasi dan Degradasi)

## Hasil analisis alur penggunaan lahan pada tingkat bentang lahan

### Peta kelompok perubahan penutupan lahan

```{r}
#| echo: false
#| warning: false
def_map |> plot_categorical_raster()
```

### Intisari kelompok perubahan penutupan lahan

::: panel-tabset
#### Tabel

```{r}
#| echo: false
def_analysis_output$landscape_level$table_traj_area
```

#### Grafik

```{r}
#| echo: false
def_analysis_output$landscape_level$barplot_traj
```
:::

## Hasil analisis pada tingkat unit perencanaan

```{r}
#| results: "asis"
#| echo: false
for (i in names(def_analysis_output[["pu_level"]])) {
  render_child(results_list = def_analysis_output[["pu_level"]], i = i)
}
```
